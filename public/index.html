<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0a0a0a" />
    <meta name="description" content="KTI - Professional Trading Dashboard" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" href="icon-192.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard-pro.css" />
    <link rel="stylesheet" href="css/narrative-engine.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <title>KTI - Professional Trading Dashboard</title>
  </head>
  <body class="dashboard-pro">
    <!-- Splash Screen -->
    <div id="splash" class="splash-screen">
      <div class="splash-content">
        <div class="splash-letters">
          <span class="letter letter-k">K</span>
          <span class="letter letter-t">T</span>
          <span class="letter letter-i">I</span>
        </div>
        <div class="splash-subtitle">Professional Trading Dashboard</div>
      </div>
    </div>

    <!-- Ticker Tape -->
    <header class="ticker-tape-container" id="ticker-tape-container">
      <div class="ticker-track" id="ticker-track">
        <div class="ticker-content" id="ticker-content">
          <!-- Ticker items populated by JS -->
        </div>
        <div class="ticker-content" id="ticker-content-duplicate">
          <!-- Duplicate for seamless loop -->
        </div>
      </div>
    </header>

    <!-- Main Dashboard Grid -->
    <main class="dashboard-grid" id="dashboard-grid">
      <!-- Left Panel: Watchlist -->
      <aside class="panel panel-watchlist" id="watchlist-panel">
        <div class="panel-header">
          <h3><i data-lucide="star" style="width:16px;height:16px;display:inline;vertical-align:middle;margin-right:6px;"></i>Watchlist</h3>
          <button class="btn-icon" id="btn-add-watchlist" title="Add Symbol"><i data-lucide="plus" style="width:16px;height:16px;"></i></button>
        </div>
        <div class="panel-content" id="watchlist-content">
          <!-- Watchlist items populated by JS -->
          <div class="empty-state" id="watchlist-empty">
            <p>No symbols in watchlist</p>
            <button class="btn-primary" id="btn-browse-symbols">Browse Symbols</button>
          </div>
        </div>
      </aside>

      <!-- Center Panel: Main Content -->
      <section class="panel panel-main" id="main-panel">
        <!-- Tabs Navigation -->
        <nav class="panel-tabs" id="main-tabs">
          <button class="tab-btn active" data-tab="overview"><i data-lucide="layout-dashboard" style="width:14px;height:14px;margin-right:4px;"></i>Overview</button>
          <button class="tab-btn" data-tab="screener"><i data-lucide="scan-search" style="width:14px;height:14px;margin-right:4px;"></i>Screener</button>
          <button class="tab-btn" data-tab="heatmap"><i data-lucide="grid-3x3" style="width:14px;height:14px;margin-right:4px;"></i>Heat Map</button>
          <button class="tab-btn" data-tab="alerts"><i data-lucide="bell" style="width:14px;height:14px;margin-right:4px;"></i>Alerts</button>
        </nav>

        <!-- Tab Content -->
        <div class="panel-content" id="main-content">
          <!-- Overview Tab -->
          <div class="tab-content active" id="tab-overview">
            <!-- Market Summary -->
            <div class="market-summary" id="market-summary">
              <div class="summary-row">
                <!-- Fear & Greed Card -->
                <div class="summary-card summary-card-fg" id="fear-greed-card">
                  <div class="card-header">
                    <span class="card-icon"><i data-lucide="gauge" style="width:20px;height:20px;"></i></span>
                    <span class="card-title">Índice Miedo y Codicia</span>
                    <span class="card-info-icon" data-info-type="fear-greed">
                      <i data-lucide="info" style="width:14px;height:14px;"></i>
                    </span>
                  </div>
                  <div class="fg-markets">
                    <div class="fg-market" id="fg-stock">
                      <span class="fg-market-label">Stock</span>
                      <span class="fg-market-value" id="fg-stock-value">--</span>
                      <span class="fg-market-status" id="fg-stock-status">--</span>
                    </div>
                    <div class="fg-market" id="fg-crypto">
                      <span class="fg-market-label">Crypto</span>
                      <span class="fg-market-value" id="fg-crypto-value">--</span>
                      <span class="fg-market-status" id="fg-crypto-status">--</span>
                    </div>
                  </div>
                  <div class="fg-divergence" id="fg-divergence" style="display: none;">
                    <span class="divergence-icon"><i data-lucide="alert-triangle" style="width:16px;height:16px;color:#f59e0b;"></i></span>
                    <span class="divergence-text" id="fg-divergence-text"></span>
                  </div>
                </div>
                <!-- DEFCON/DOUGHCON Card -->
                <div class="summary-card summary-card-defcon" id="defcon-card">
                  <div class="card-header">
                    <span class="card-icon"><i data-lucide="shield-alert" style="width:20px;height:20px;"></i></span>
                    <span class="card-title">Índice Geopolítico</span>
                    <span class="card-info-icon" data-info-type="geopolitical">
                      <i data-lucide="info" style="width:14px;height:14px;"></i>
                    </span>
                  </div>
                  <div class="defcon-display">
                    <div class="defcon-level-circle" id="defcon-circle">
                      <span class="defcon-number" id="defcon-value">--</span>
                    </div>
                    <div class="defcon-info">
                      <div class="defcon-row">
                        <span class="defcon-label">Estado</span>
                        <span class="defcon-badge" id="defcon-status">--</span>
                      </div>
                      <div class="defcon-row">
                        <span class="defcon-label">Riesgo</span>
                        <span class="defcon-badge" id="defcon-risk">--</span>
                      </div>
                    </div>
                  </div>
                  <div class="defcon-anomaly" id="defcon-anomaly" style="display: none;">
                    <span class="anomaly-icon"><i data-lucide="alert-triangle" style="width:16px;height:16px;color:#ef4444;"></i></span>
                    <span class="anomaly-text">Anomalía detectada</span>
                  </div>
                </div>
                <!-- NEH Index Card -->
                <div class="summary-card summary-card-neh" id="neh-card">
                  <div class="card-header">
                    <span class="card-icon"><i data-lucide="eye" style="width:20px;height:20px;"></i></span>
                    <span class="card-title">Índice Cisne Negro</span>
                    <span class="card-info-icon" data-info-type="black-swan">
                      <i data-lucide="info" style="width:14px;height:14px;"></i>
                    </span>
                  </div>
                  <div class="neh-display">
                    <div class="neh-value-circle" id="neh-circle">
                      <span class="neh-number" id="neh-value">--</span>
                    </div>
                    <div class="neh-info">
                      <div class="neh-row">
                        <span class="neh-label">Estado</span>
                        <span class="neh-badge" id="neh-status">--</span>
                      </div>
                      <div class="neh-row">
                        <span class="neh-label">Nivel</span>
                        <span class="neh-badge" id="neh-classification">--</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Top Movers -->
            <div class="top-movers" id="top-movers">
              <div class="movers-section gainers">
                <h4><i data-lucide="trending-up" style="width:16px;height:16px;color:#22c55e;margin-right:6px;"></i>Top Gainers</h4>
                <div id="gainers-list">
                  <!-- Populated by JS -->
                </div>
              </div>
              <div class="movers-section losers">
                <h4><i data-lucide="trending-down" style="width:16px;height:16px;color:#ef4444;margin-right:6px;"></i>Top Losers</h4>
                <div id="losers-list">
                  <!-- Populated by JS -->
                </div>
              </div>
            </div>

            <!-- Quotes Table -->
            <div class="quotes-container" id="quotes-container">
              <table class="quotes-table" id="quotes-table">
                <thead>
                  <tr>
                    <th data-sort="symbol">Symbol</th>
                    <th data-sort="price">Price</th>
                    <th data-sort="change">Change</th>
                    <th data-sort="confidence">Confidence</th>
                    <th>Sparkline</th>
                    <th data-sort="signal">Signal</th>
                  </tr>
                </thead>
                <tbody id="quotes-tbody">
                  <!-- Populated by JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Screener Tab -->
          <div class="tab-content" id="tab-screener">
            <div class="screener" id="screener">
              <div class="screener-filters" id="screener-filters">
                <div class="filter-row">
                  <select id="filter-indicator">
                    <option value="">Select Indicator</option>
                    <option value="confidence">Confidence</option>
                    <option value="rsi">RSI</option>
                    <option value="adx">ADX</option>
                    <option value="direction">Direction</option>
                  </select>
                  <select id="filter-condition">
                    <option value="above">Above</option>
                    <option value="below">Below</option>
                    <option value="equals">Equals</option>
                  </select>
                  <input type="text" id="filter-value" placeholder="Value" />
                  <button class="btn-icon" id="btn-add-filter"><i data-lucide="plus" style="width:14px;height:14px;"></i></button>
                </div>
                <div class="active-filters" id="active-filters">
                  <!-- Active filter badges -->
                </div>
                <button class="btn-scan" id="btn-scan"><i data-lucide="radar" style="width:14px;height:14px;margin-right:4px;"></i>Scan Market</button>
              </div>
              <div class="screener-results" id="screener-results">
                <!-- Results populated by JS -->
              </div>
            </div>
          </div>

          <!-- Heat Map Tab -->
          <div class="tab-content" id="tab-heatmap">
            <div class="heatmap-container" id="heatmap-container">
              <!-- Heat map populated by JS -->
            </div>
          </div>

          <!-- Alerts Tab -->
          <div class="tab-content" id="tab-alerts">
            <div class="alerts-panel" id="alerts-panel">
              <div class="alerts-header">
                <button class="btn-primary" id="btn-new-alert"><i data-lucide="bell-plus" style="width:14px;height:14px;margin-right:4px;"></i>New Alert</button>
              </div>
              <div class="alerts-list" id="alerts-list">
                <!-- Alerts populated by JS -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Right Panel: Details -->
      <aside class="panel panel-details" id="details-panel">
        <div class="panel-header">
          <h3 id="details-title"><i data-lucide="info" style="width:16px;height:16px;margin-right:6px;"></i>Details</h3>
          <button class="btn-icon" id="btn-close-details" title="Close"><i data-lucide="x" style="width:16px;height:16px;"></i></button>
        </div>
        <div class="panel-content" id="details-content">
          <!-- Details populated by JS -->
          <div class="empty-state" id="details-empty">
            <p>Select a symbol to view details</p>
          </div>
        </div>
      </aside>
    </main>

    <!-- Status Bar -->
    <footer class="status-bar" id="status-bar">
      <div class="status-connection" id="status-connection">
        <span class="status-dot" id="ws-status-dot"></span>
        <span id="ws-status-text">Disconnected</span>
      </div>
      <div class="status-alerts" id="status-alerts">
        <i data-lucide="bell" style="width:12px;height:12px;margin-right:4px;"></i>
        <span id="active-alerts-count">0 active alerts</span>
      </div>
      <div class="status-shortcuts">
        <i data-lucide="keyboard" style="width:12px;height:12px;margin-right:4px;"></i>
        <span>Press <kbd>?</kbd> for shortcuts</span>
      </div>
      <div class="status-time" id="status-time">
        <i data-lucide="clock" style="width:12px;height:12px;margin-right:4px;"></i>
        <span id="market-time">--:--:--</span>
      </div>
    </footer>

    <!-- Modal: Add to Watchlist -->
    <div class="modal-overlay" id="modal-add-watchlist">
      <div class="modal">
        <div class="modal-header">
          <h3><i data-lucide="star" style="width:18px;height:18px;margin-right:8px;"></i>Add Symbol to Watchlist</h3>
          <button class="modal-close" data-close-modal><i data-lucide="x" style="width:18px;height:18px;"></i></button>
        </div>
        <div class="modal-body">
          <div style="position:relative;">
            <i data-lucide="search" style="width:16px;height:16px;position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:0.5;"></i>
            <input type="text" id="search-symbol" placeholder="Search symbols..." class="search-input" style="padding-left:36px;" />
          </div>
          <div class="symbol-search-results" id="symbol-search-results">
            <!-- Search results -->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Create Alert -->
    <div class="modal-overlay" id="modal-create-alert">
      <div class="modal">
        <div class="modal-header">
          <h3><i data-lucide="bell-plus" style="width:18px;height:18px;margin-right:8px;"></i>Create Alert</h3>
          <button class="modal-close" data-close-modal><i data-lucide="x" style="width:18px;height:18px;"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Symbol</label>
            <select id="alert-symbol">
              <!-- Options populated by JS -->
            </select>
          </div>
          <div class="form-group">
            <label>Alert Type</label>
            <select id="alert-type">
              <option value="price">Price</option>
              <option value="signal">Signal Change</option>
            </select>
          </div>
          <div class="form-group" id="alert-price-group">
            <label>Condition</label>
            <select id="alert-condition">
              <option value="above">Above</option>
              <option value="below">Below</option>
            </select>
            <input type="number" id="alert-price-value" placeholder="Price" />
          </div>
          <div class="form-group">
            <label>Message (optional)</label>
            <input type="text" id="alert-message" placeholder="Alert message" />
          </div>
          <button class="btn-primary" id="btn-create-alert"><i data-lucide="check" style="width:14px;height:14px;margin-right:4px;"></i>Create Alert</button>
        </div>
      </div>
    </div>

    <!-- Modal: Keyboard Shortcuts -->
    <div class="modal-overlay" id="modal-shortcuts">
      <div class="modal">
        <div class="modal-header">
          <h3><i data-lucide="keyboard" style="width:18px;height:18px;margin-right:8px;"></i>Keyboard Shortcuts</h3>
          <button class="modal-close" data-close-modal><i data-lucide="x" style="width:18px;height:18px;"></i></button>
        </div>
        <div class="modal-body">
          <div class="shortcuts-list">
            <div class="shortcut-item">
              <span class="shortcut-key">?</span>
              <span class="shortcut-desc">Show shortcuts</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">W</span>
              <span class="shortcut-desc">Toggle watchlist</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">D</span>
              <span class="shortcut-desc">Toggle details</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">S</span>
              <span class="shortcut-desc">Focus search</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">1</span>
              <span class="shortcut-desc">Overview tab</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">2</span>
              <span class="shortcut-desc">Screener tab</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">3</span>
              <span class="shortcut-desc">Heat Map tab</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">4</span>
              <span class="shortcut-desc">Alerts tab</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">C</span>
              <span class="shortcut-desc">Toggle compact mode</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">Esc</span>
              <span class="shortcut-desc">Close modal/panel</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Index Info -->
    <div class="info-modal-overlay" id="info-modal">
      <div class="info-modal">
        <div class="info-modal-header">
          <div class="modal-icon" id="info-modal-icon">
            <i data-lucide="info" style="width:20px;height:20px;"></i>
          </div>
          <span class="modal-title" id="info-modal-title">Información</span>
        </div>
        <div class="info-modal-body" id="info-modal-body">
          <!-- Content will be dynamically inserted -->
        </div>
        <div class="info-modal-footer">
          <button class="btn-close-info" id="btn-close-info">Entendido</button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <script type="module" src="js/dashboard.js"></script>
    <script>
      // Inicializar Lucide Icons
      lucide.createIcons();
      // Re-inicializar cuando se actualice el DOM dinámicamente
      window.refreshLucideIcons = () => lucide.createIcons();
    </script>
  </body>
</html>
